import{W as D,s as B}from"./utils-f2d0253a-570d2917.js";var M=globalThis&&globalThis.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n},C=function(){if(typeof Map<"u")return Map;function t(e,r){var n=-1;return e.some(function(i,o){return i[0]===r?(n=o,!0):!1}),n}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(r){var n=t(this.__entries__,r),i=this.__entries__[n];return i&&i[1]},e.prototype.set=function(r,n){var i=t(this.__entries__,r);~i?this.__entries__[i][1]=n:this.__entries__.push([r,n])},e.prototype.delete=function(r){var n=this.__entries__,i=t(n,r);~i&&n.splice(i,1)},e.prototype.has=function(r){return!!~t(this.__entries__,r)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(r,n){n===void 0&&(n=null);for(var i=0,o=this.__entries__;i<o.length;i++){var a=o[i];r.call(n,a[1],a[0])}},e}()}(),R=typeof window<"u"&&typeof document<"u"&&window.document===document,b=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),I=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(b):function(t){return setTimeout(function(){return t(Date.now())},1e3/60)}}(),F=2;function W(t,e){var r=!1,n=!1,i=0;function o(){r&&(r=!1,t()),n&&s()}function a(){I(o)}function s(){var u=Date.now();if(r){if(u-i<F)return;n=!0}else r=!0,n=!1,setTimeout(a,e);i=u}return s}var j=20,q=["top","right","bottom","left","width","height","size","weight"],H=typeof MutationObserver<"u",Y=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=W(this.refresh.bind(this),j)}return t.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},t.prototype.removeObserver=function(e){var r=this.observers_,n=r.indexOf(e);~n&&r.splice(n,1),!r.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){var e=this.updateObservers_();e&&this.refresh()},t.prototype.updateObservers_=function(){var e=this.observers_.filter(function(r){return r.gatherActive(),r.hasActive()});return e.forEach(function(r){return r.broadcastActive()}),e.length>0},t.prototype.connect_=function(){!R||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),H?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){!R||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(e){var r=e.propertyName,n=r===void 0?"":r,i=q.some(function(o){return!!~n.indexOf(o)});i&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),z=function(t,e){for(var r=0,n=Object.keys(e);r<n.length;r++){var i=n[r];Object.defineProperty(t,i,{value:e[i],enumerable:!1,writable:!1,configurable:!0})}return t},w=function(t){var e=t&&t.ownerDocument&&t.ownerDocument.defaultView;return e||b},T=y(0,0,0,0);function g(t){return parseFloat(t)||0}function x(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return e.reduce(function(n,i){var o=t["border-"+i+"-width"];return n+g(o)},0)}function K(t){for(var e=["top","right","bottom","left"],r={},n=0,i=e;n<i.length;n++){var o=i[n],a=t["padding-"+o];r[o]=g(a)}return r}function X(t){var e=t.getBBox();return y(0,0,e.width,e.height)}function N(t){var e=t.clientWidth,r=t.clientHeight;if(!e&&!r)return T;var n=w(t).getComputedStyle(t),i=K(n),o=i.left+i.right,a=i.top+i.bottom,s=g(n.width),u=g(n.height);if(n.boxSizing==="border-box"&&(Math.round(s+o)!==e&&(s-=x(n,"left","right")+o),Math.round(u+a)!==r&&(u-=x(n,"top","bottom")+a)),!U(t)){var v=Math.round(s+o)-e,f=Math.round(u+a)-r;Math.abs(v)!==1&&(s-=v),Math.abs(f)!==1&&(u-=f)}return y(i.left,i.top,s,u)}var $=function(){return typeof SVGGraphicsElement<"u"?function(t){return t instanceof w(t).SVGGraphicsElement}:function(t){return t instanceof w(t).SVGElement&&typeof t.getBBox=="function"}}();function U(t){return t===w(t).document.documentElement}function J(t){return R?$(t)?X(t):N(t):T}function Q(t){var e=t.x,r=t.y,n=t.width,i=t.height,o=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,a=Object.create(o.prototype);return z(a,{x:e,y:r,width:n,height:i,top:r,right:e+n,bottom:i+r,left:e}),a}function y(t,e,r,n){return{x:t,y:e,width:r,height:n}}var Z=function(){function t(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=y(0,0,0,0),this.target=e}return t.prototype.isActive=function(){var e=J(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},t}(),ee=function(){function t(e,r){var n=Q(r);z(this,{target:e,contentRect:n})}return t}(),te=function(){function t(e,r,n){if(this.activeObservations_=[],this.observations_=new C,typeof e!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=r,this.callbackCtx_=n}return t.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof w(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;r.has(e)||(r.set(e,new Z(e)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(e instanceof w(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;r.has(e)&&(r.delete(e),r.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(r){r.isActive()&&e.activeObservations_.push(r)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,r=this.activeObservations_.map(function(n){return new ee(n.target,n.broadcastRect())});this.callback_.call(e,r,e),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),G=typeof WeakMap<"u"?new WeakMap:new C,L=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var r=Y.getInstance(),n=new te(e,r,this);G.set(this,n)}return t}();["observe","unobserve","disconnect"].forEach(function(t){L.prototype[t]=function(){var e;return(e=G.get(this))[t].apply(e,arguments)}});var re=function(){return typeof b.ResizeObserver<"u"?b.ResizeObserver:L}(),O=function(t){return"scrollX"in t?{x:t.scrollX,y:t.scrollY}:{x:t.scrollLeft,y:t.scrollTop}},ne=function(t,e,r){var n=r.x,i=r.y,o=window.devicePixelRatio,a=t.left,s=t.bottom,u=t.width,v=t.height,f=e.bottom-(s-i),d=(a-e.left-n)*o,l=f*o,p=u*o,_=v*o;return{left:d,bottom:l,width:p,height:_}},ie=function(t,e){var r=e.x,n=e.y,i=t.getBoundingClientRect();return{width:i.width,height:i.height,left:i.left+r,right:i.right+r,bottom:i.bottom+n,top:i.top+n,x:i.x+r,y:i.y+n,density:window.devicePixelRatio}},oe=function(){function t(e,r){this.rectMap={},this.canvas=e,this.viewFrame=r,this.updateCanvas()}return t.prototype.updateCanvas=function(){this.canvasRect=this.canvas.getBoundingClientRect()},t.prototype.updateChartScene=function(e,r){this.rectMap[e]=r},t.prototype.clipRect=function(e){return this.rectMap[e]?ne(this.rectMap[e],this.canvasRect,O(this.viewFrame)):void 0},t.prototype.removeChartScene=function(e){delete this.rectMap[e]},t}(),ae=function(){function t(){var e=this;this.viewportManagers=[],this.viewportMap={},this.viewportLiveId={},this.managers=function(){return M(e.viewportManagers)},this.dispose=function(){e.viewportManagers.forEach(function(r){var n=r.id;return e.remove(n)})},this.startTick=function(r){var n=r.manager,i=r.duration,o=r.chartSize;if(o!=null){var a=new Date(new Date().getTime()-i),s=new Date,u=n.viewportGroup!=null?n.viewportGroup:n.id,v=n.id,f=1/o.width*i;v in e.viewportLiveId||(e.viewportLiveId[v]={viewportGroup:n.viewportGroup},e.viewportLiveId[v].intervalId=setInterval(function(){var d=new Date(Date.now()-i),l=new Date;e.viewportMap[u]={start:d,end:l};var p=!!i;n.updateViewPort({start:d,end:l,duration:i,shouldBlockSetViewport:p})},f),e.viewportMap[u]={start:a,end:s},e.syncViewPortGroup({start:a,end:s,manager:n,duration:i}))}},this.stopTick=function(r){var n=r.manager,i=r.viewportGroup;if(!(n==null&&i==null)){var o=function(a){e.viewportLiveId[a]!=null&&(clearInterval(e.viewportLiveId[a].intervalId),delete e.viewportLiveId[a])};i!=null?Object.entries(e.viewportLiveId).filter(function(a){var s=a[1];return s.viewportGroup===i}).forEach(function(a){var s=a[0];return o(s)}):n!=null&&o(n.id)}},this.add=function(r){var n=r.manager,i=r.chartSize,o=r.duration,a=r.shouldSync,s=a===void 0?!0:a;if(e.viewportManagers=M(e.viewportManagers,[n]),n.viewportGroup&&e.viewportMap[n.viewportGroup]&&s){var u=!!o;n.updateViewPort(Object.assign(Object.assign({},e.viewportMap[n.viewportGroup]),{duration:o,shouldBlockSetViewport:u}))}o!=null&&e.startTick({manager:n,duration:o,chartSize:i})},this.remove=function(r){var n=e.viewportManagers.find(function(i){var o=i.id;return o===r});n&&n.dispose&&(e.stopTick({manager:n}),n.dispose()),e.viewportManagers=e.viewportManagers.filter(function(i){var o=i.id;return o!==r})},this.syncViewPortGroup=function(r){var n=r.start,i=r.end,o=r.manager,a=r.duration,s=o.viewportGroup?o.viewportGroup:o.id;e.viewportMap[s]={start:n,end:i},a==null&&e.stopTick({manager:o,viewportGroup:o.viewportGroup});var u=function(f){var d=!!a;f.updateViewPort({start:n,end:i,duration:a,shouldBlockSetViewport:d})};if(o.viewportGroup){var v=e.viewportManagers.filter(function(f){var d=f.viewportGroup;return o.viewportGroup===d});v.forEach(u)}else u(o)}}return t}(),se=B(function(t){return t.camera!=null}),ue=function(t,e,r){var n=e.scene,i=e.camera,o=r.left,a=r.bottom,s=r.width,u=r.height;t.setScissor(o,a,s,u),t.setViewport(o,a,s,u),t.render(n,i)};function ce(t){var e=t.domElement,r=Math.floor(e.clientWidth*window.devicePixelRatio)||0,n=Math.floor(e.clientHeight*window.devicePixelRatio)||0,i=e.width!==r||e.height!==n;return i&&t.setSize(r,n,!1),i}var fe=function(t){var e,r=function(c){var h=c.manager,m=c.chartSize,E=c.duration,S=c.shouldSync,k=S===void 0?!0:S;return t.add({manager:h,chartSize:m,duration:E,shouldSync:k})},n=function(c){l(),t.remove(c),e.removeChartScene(c),u()},i,o,a,s,u=function(){if(i){i.setScissorTest(!1),i.setClearColor(16777215,0),i.clear(),i.setScissorTest(!0);var c=t.managers().filter(se);c.forEach(p)}},v=function(){if(i&&o){if(!a)return;var c=O(a),h=c.x,m=c.y,E="translate("+h+"px, "+m+"px)";i.domElement.style.transform=E,e.updateCanvas(),u()}},f=function(){l(),i&&o&&(ce(i),e.updateCanvas(),u())},d=function(c,h,m){h===void 0&&(h=function(){}),o=c,i=new D({canvas:o,alpha:!0,antialias:!0,preserveDrawingBuffer:!0}),a=m||window,e=new oe(c,a),h(i.getContext()),i.setScissorTest(!0),i.setClearColor(0,0),v(),f(),a.addEventListener("scroll",v),a instanceof Element?(s=new re(f),s.observe(a)):a.addEventListener("resize",f)},l=function(){if(e==null)throw new Error("webgl context must be initialized before it can be utilized. Please refer to https://synchrocharts.com/#/Setup to learn more about how to setup IoT App Kit Visualizations.")},p=function(c){l();var h=e.clipRect(c.id);i&&o&&h&&ue(i,c,h)},_=function(){i&&i.dispose(),t.dispose(),a&&(a.removeEventListener("scroll",v),a.removeEventListener("resize",f)),s&&s.disconnect()},A=function(c,h){l(),e.updateChartScene(c,h),u()},P=function(c){return ie(c,a?O(a):{x:0,y:0})},V=function(){f()};return{initRendering:d,dispose:_,render:p,addChartScene:r,removeChartScene:n,setChartRect:A,getRectScrollFixed:P,updateViewPorts:t.syncViewPortGroup,startTick:t.startTick,stopTick:t.stopTick,onResolutionChange:V}},he=fe(new ae);export{re as i,he as w};
